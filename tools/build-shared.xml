<?xml version="1.0" encoding="UTF-8"?>
<project name="DocBook XSLT 1.0 stylesheets - Shared settings" default="all">

  <property name="dbroot.dir" value="${ant.file}/.."/>
  <property name="libs" value="${dbroot.dir}/tools/lib"/>
  <property name="saxon9.jar" value="${libs}/saxon9he.jar"/>
  <property name="saxon.jar" value="${libs}/saxon.jar"/>
  <property name="xalan.jar" value="${libs}/xalan.jar"/>
  <property name="xerces.jar" value="${libs}/xercesImpl.jar"/>
  <property name="saxon-ant.jar" value="${libs}/saxon9-ant.jar"/>
  <property name="jing.jar" value="${libs}/jing.jar"/>
  <property name="ant-contrib.jar" value="${libs}/ant-contrib-1.0b3.jar"/>

  <property name="extensions.jar"
            value="${dbroot.dir}/extensions/saxon65.jar"/>

  <taskdef name="jing"
           classname="com.thaiopensource.relaxng.util.JingTask"
           classpath="${jing.jar}"/>

  <path id="saxon9.classpath">
    <pathelement location="${saxon9.jar}"/>
    <pathelement location="${saxon-ant.jar}"/>
  </path>

  <path id="saxon.classpath">
    <pathelement location="${xerces.jar}"/>
    <pathelement location="${saxon.jar}"/>
    <pathelement location="${extensions.jar}"/>
  </path>

  <path id="calabash.classpath">
    <pathelement location="${saxon9.jar}"/>
    <pathelement location="${saxon-ant.jar}"/>
    <pathelement location="${extensions.jar}"/>
    <pathelement location="${libs}/calabash.jar"/>
    <pathelement location="${libs}/xmlresolver.jar"/>
    <pathelement location="${libs}/commons-codec-1.3.jar"/>
    <pathelement location="${libs}/commons-httpclient-3.1.jar"/>
    <pathelement location="${libs}/commons-logging-1.1.1.jar"/>
  </path>

  <taskdef name="xslt2"
           classname="net.sf.saxon.ant.AntTransform">
    <classpath refid="saxon9.classpath"/>
  </taskdef>

  <target name="build-params">
    <!-- FIXME parameter checking -->
    <xslt in="param.xweb" out=".param.profiled" style="../profiling/profile.xsl">
      <factory name="com.icl.saxon.TransformerFactoryImpl"/>
      <classpath refid="saxon.classpath"/>
      <param name="profile.condition" expression="${condition}"/>
    </xslt>
    <xslt in=".param.profiled" out=".param.stripped" style="../profiling/strip-attributes.xsl">
      <factory name="com.icl.saxon.TransformerFactoryImpl"/>
      <classpath refid="saxon.classpath"/>
      <param name="attributes" expression="condition"/>
    </xslt>
    <xslt in=".param.stripped" out=".param.dbkns" style="../../releasetools/xtangle.xsl">
      <factory name="com.icl.saxon.TransformerFactoryImpl"/>
      <classpath refid="saxon.classpath"/>
    </xslt>
    <xslt in=".param.dbkns" out="param.xsl.tmp" style="../tools/xsl/build/fix-params-ns.xsl">
      <factory name="com.icl.saxon.TransformerFactoryImpl"/>
      <classpath refid="saxon.classpath"/>
    </xslt>
    <xslt in="param.xsl.tmp" out="param.xsl" style="../tools/xsl/build/addnewline.xsl">
      <factory name="com.icl.saxon.TransformerFactoryImpl"/>
      <classpath refid="saxon.classpath"/>
    </xslt>
  </target>

  <target name="clean-params">
    <delete>
      <fileset dir=".">
	<include name=".param.profiled"/>
	<include name=".param.stripped"/>
	<include name=".param.dbkns"/>
	<include name="param.xsl.tmp"/>
	<include name="param.xsl"/>
      </fileset>
    </delete>
  </target>

</project>
